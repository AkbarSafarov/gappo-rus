{"version":3,"names":[],"mappings":"","sources":["other_prj/form.js"],"sourcesContent":["// Установка куки\n// time - время жизни в миллисекундах\nfunction setCookie(name, value, time) {\n\tconst date = new Date();\n\tdate.setTime(date.getTime() + time);\n\tdocument.cookie = `${encodeURIComponent(name)}=${encodeURIComponent(value)};expires=${date.toUTCString()};path=/`;\n\treturn console.log(`cookie ${name} ${value} - added`);\n};\n\n// Получение куки по имени\nfunction getCookie(name) {\n\tconst matches = document.cookie.match(new RegExp('(?:^|; )' + encodeURIComponent(name) + '=([^;]*)'));\n\treturn matches ? decodeURIComponent(matches[1]) : null;\n};\n\n// Удаление куки\nfunction deleteCookie(name) {\n\tdocument.cookie = `${encodeURIComponent(name)}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;\n\treturn console.log(`cookie ${name} - deleted`);\n};\n\n\nfunction FormHandler(form) {\n\tthis.form = form;\n\n\tthis.error = {\n\t\tmessage: 'Непредвиденная ошибка',\n\t\tstatus: 'error'\n\t}\n\n\tthis.loader = null;\n\tif (typeof Loader != 'undefined')\n\t\tthis.loader = new Loader();\n\n\tif (typeof FormValidator != 'undefined')\n\t\tthis.validator = new FormValidator({\n\t\t\ttexts: {\n\t\t\t\tinvalid: 'Неправильное значение',\n\t\t\t\tshort: 'Введите больше символов',\n\t\t\t\tlong: 'Введите меньше символов',\n\t\t\t\tchecked: 'Должно быть отмечено',\n\t\t\t\tempty: 'Это поле пустое',\n\t\t\t\tselect: 'Пожалуйста, выберите опцию',\n\t\t\t\tnumber_min: 'Слишком маленькое значение',\n\t\t\t\tnumber_max: 'Слишком высокое значение',\n\t\t\t\turl: 'Недействительный URL',\n\t\t\t\tnumber: 'Не является числом',\n\t\t\t\temail: 'Некорректный E-mail',\n\t\t\t\tno_match: 'Нет совпадения',\n\t\t\t\tcomplete: 'Ввод не завершен'\n\t\t\t},\n\t\t\tclasses: {\n\t\t\t\titem: 'ui-ctl',\n\t\t\t\talert: 'ui-ctl-tag ui-ctl-tag-danger',\n\t\t\t\tbad: 'ui-ctl-danger'\n\t\t\t},\n\t\t\tevents: ['blur']\n\t\t})\n\telse\n\t\treturn;\n\n\tthis.init();\n}\n\nFormHandler.prototype.init = function () {\n\tthis.form.addEventListener('blur', (e) => {\n\t\tthis.validator.checkField(e.target);\n\t}, true);\n\n\tthis.form.onsubmit = (e) => {\n\t\te.preventDefault();\n\t\tthis.handleSubmit(e);\n\t};\n};\n\nFormHandler.prototype.handleSubmit = function (event) {\n\tthis.form.submitter = event.submitter;\n\tconst\n\t\tresult = this.validator.checkAll(this.form),\n\t\taction = this.form.getAttribute('action'),\n\t\tdata = new FormData(this.form);\n\n\tif (!!result.valid && !!action) {\n\t\tthis.form.submitter.disabled = true;\n\t\tthis.form.submitter.style.display = 'none';\n\t\tif (typeof Loader != 'undefined')\n\t\t\tthis.loader?.type();\n\n\t\tfetch(action, {\n\t\t\theaders: { 'X-Requested-With': 'XMLHttpRequest' },\n\t\t\tmethod: 'POST',\n\t\t\tbody: data,\n\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (typeof Loader != 'undefined')\n\t\t\t\t\tthis.loader?.type('close');\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error('Ответ сети не соответствует ожиданиям');\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(jsonData => {\n\t\t\t\tif (typeof Loader != 'undefined')\n\t\t\t\t\tthis.loader?.type('close');\n\t\t\t\tthis.handleResponse(jsonData)\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tif (typeof Loader != 'undefined')\n\t\t\t\t\tthis.loader?.type('close');\n\t\t\t\tthis.handleResponse(this.error, error)\n\t\t\t});\n\t}\n};\n\nFormHandler.prototype.handleResponse = function (data, error = null) {\n\tlet\n\t\talertClass = ' alert-danger',\n\t\talertText = 'Произошла ошибка!',\n\t\tboolSuccess = false;\n\n\tif (typeof data === 'object' && data.status !== 'error') {\n\t\tthis.form.reset();\n\t\talertClass = ' alert-success';\n\t\talertText = 'Заявка отправлена!';\n\t\tboolSuccess = true;\n\t}\n\n\tconst alert = document.createElement('div');\n\talert.className = 'alert' + alertClass;\n\talert.innerHTML = '<span class=\"small\"><strong>' + alertText + '</strong> ' + (data.message || 'Непредвиденная ошибка') + '</span>';\n\n\tconst nextAlertElement = this.form.querySelector('[data-alert-insert]');\n\tif (nextAlertElement)\n\t\tnextAlertElement.insertAdjacentElement('afterend', alert);\n\telse\n\t\tthis.form.append(alert);\n\n\tsetTimeout(() => {\n\t\tthis.form.submitter.disabled = false;\n\t\tthis.form.submitter.style.display = '';\n\t\talert.remove();\n\t\tif (boolSuccess) {\n\t\t\tFancybox.close();\n\t\t}\n\t}, 5000);\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tsetTimeout(() => {\n\t\tfor (let form of document.forms) {\n\t\t\tif (!form.noValidate) continue;\n\t\t\tnew FormHandler(form);\n\t\t}\n\t}, 100);\n});"],"file":"form.js"}