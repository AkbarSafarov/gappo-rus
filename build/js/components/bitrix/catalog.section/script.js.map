{"version":3,"names":[],"mappings":"","sources":["components/bitrix/catalog.section/script.js"],"sourcesContent":["(function () {\n\t'use strict';\n\n\n\n\n\tif (!window.JCCatalogSectionComponent) {\n\t\twindow.JCCatalogSectionComponent = function (params) {\n\t\t\tthis.formPosting = false;\n\t\t\tthis.siteId = params.siteId || '';\n\t\t\tthis.ajaxId = params.ajaxId || '';\n\t\t\tthis.template = params.template || '';\n\t\t\tthis.componentPath = params.componentPath || '';\n\t\t\tthis.parameters = params.parameters || '';\n\t\t\tthis.containerSelector = params.container || '';\n\t\t\tthis.container = null;\n\t\t\tthis.ajaxPath = '/local/ajax/';\n\t\t\tthis.sessid = BX?.bitrix_sessid() ?? null;\n\t\t\tthis.lazyLoad = params.lazyLoad ?? false;\n\t\t\tthis.showMoreButton = null;\n\t\t\tthis.showMoreButtonMessage = null;\n\t\t\tthis.params = {\n\t\t\t\teventAdd2Basket: 'data-add2basket'\n\t\t\t}\n\n\t\t\tif (params.navParams) {\n\t\t\t\tthis.navParams = {\n\t\t\t\t\tNavNum: params.navParams.NavNum || 1,\n\t\t\t\t\tNavPageNomer: parseInt(params.navParams.NavPageNomer) || 1,\n\t\t\t\t\tNavPageCount: parseInt(params.navParams.NavPageCount) || 1\n\t\t\t\t};\n\t\t\t}\n\n\n\n\n\t\t\t// this.bigData = params.bigData || {enabled: false};\n\n\n\t\t\t// if (this.bigData.enabled && BX.util.object_keys(this.bigData.rows).length > 0)\n\t\t\t// {\n\t\t\t// \tBX.cookie_prefix = this.bigData.js.cookiePrefix || '';\n\t\t\t// \tBX.cookie_domain = this.bigData.js.cookieDomain || '';\n\t\t\t// \tBX.current_server_time = this.bigData.js.serverTime;\n\n\t\t\t// \tBX.ready(BX.delegate(this.bigDataLoad, this));\n\t\t\t// }\n\n\t\t\t// if (params.initiallyShowHeader)\n\t\t\t// {\n\t\t\t// \tBX.ready(BX.delegate(this.showHeader, this));\n\t\t\t// }\n\n\t\t\t// if (params.deferredLoad)\n\t\t\t// {\n\t\t\t// \tBX.ready(BX.delegate(this.deferredLoad, this));\n\t\t\t// }\n\n\n\n\t\t\t// if (params.loadOnScroll)\n\t\t\t// {\n\t\t\t// \tBX.bind(window, 'scroll', BX.proxy(this.loadOnScroll, this));\n\t\t\t// }\n\n\n\t\t\tif (typeof params === 'object') {\n\t\t\t\tdocument.addEventListener('DOMContentLoaded', this.init.bind(this));\n\t\t\t}\n\n\n\t\t};\n\n\t\twindow.JCCatalogSectionComponent.prototype = {\n\t\t\tinit: function () {\n\t\t\t\tif (this.containerSelector) {\n\t\t\t\t\tthis.container = document.querySelector('[data-entity=\"' + this.containerSelector + '\"]');\n\t\t\t\t\tthis.container.querySelectorAll('[' + this.params.eventAdd2Basket + ']').forEach(button => {\n\t\t\t\t\t\tbutton.addEventListener('click', this.add2basket.bind(this));\n\t\t\t\t\t});\n\n\t\t\t\t}\n\n\t\t\t\tif (this.lazyLoad) {\n\t\t\t\t\tthis.showMoreButton = document.querySelector('[data-use=\"show-more-' + this.navParams.NavNum + '\"]');\n\t\t\t\t\tthis.showMoreButtonMessage = this.showMoreButton.innerHTML;\n\t\t\t\t\tthis.showMoreButton.addEventListener('click', this.showMore.bind(this));\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tadd2basket: function (event) {\n\t\t\t\tlet target = event.currentTarget;\n\n\t\t\t\tconst productId = target.getAttribute(this.params.eventAdd2Basket);\n\t\t\t\tconst originalText = target.innerHTML;\n\n\t\t\t\ttarget.disabled = true;\n\t\t\t\t// event.textContent = 'Обработка...';\n\n\t\t\t\tconst formData = {\n\t\t\t\t\tsessid: this.sessid,\n\t\t\t\t\taction: 'add2basket',\n\t\t\t\t\tproductId: productId\n\t\t\t\t}\n\n\t\t\t\tfetch(this.ajaxPath + 'add2basket.php', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: JSON.stringify(formData),\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tthrow new Error('Network response was not ok');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn response.json();\n\t\t\t\t\t})\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\tlet content, dataNotification;\n\n\t\t\t\t\t\tif (typeof BX?.UI?.Notification === 'object') {\n\t\t\t\t\t\t\tcontent = data?.text ?? null;\n\t\t\t\t\t\t\tif (data.type !== 'success')\n\t\t\t\t\t\t\t\tdataNotification = { type: 'danger', icon: 'warning' }\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdataNotification = { type: 'success' }\n\n\t\t\t\t\t\t\tif (content) {\n\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\t\t\t\tdata: dataNotification,\n\t\t\t\t\t\t\t\t\tposition: 'top-right',\n\t\t\t\t\t\t\t\t\trender: alertBalloonRenderer,\n\t\t\t\t\t\t\t\t\tcategory: 'add2basket',\n\t\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => console.error('Fetch error:', error))\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\ttarget.disabled = false;\n\t\t\t\t\t\t// event.innerHTML = originalText;\n\t\t\t\t\t\tBX.onCustomEvent('OnBasketChange');\n\t\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tcheckButton: function () {\n\t\t\t\tif (this.showMoreButton) {\n\t\t\t\t\tif (this.navParams.NavPageNomer == this.navParams.NavPageCount) {\n\t\t\t\t\t\tthis.showMoreButton.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// this.container.appendChild(this.showMoreButton);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tenableButton: function () {\n\t\t\t\tif (this.showMoreButton) {\n\t\t\t\t\tthis.showMoreButton.classList.remove('disabled');\n\t\t\t\t\tthis.showMoreButton.innerHTML = this.showMoreButtonMessage;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tdisableButton: function () {\n\t\t\t\tif (this.showMoreButton) {\n\t\t\t\t\tthis.showMoreButton.classList.add('disabled');\n\t\t\t\t\t// this.showMoreButton.innerHTML = BX.message('BTN_MESSAGE_LAZY_LOAD_WAITER');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tsetAddBasketItems: function (obj) {\n\t\t\t\tif (typeof obj !== 'object')\n\t\t\t\t\treturn;\n\n\t\t\t\tObject.keys(obj).forEach(id => {\n\t\t\t\t\t// this.setAddBasketItem(id);\n\t\t\t\t})\n\t\t\t},\n\t\t\tsetAddBasketItem: function (id = null) {\n\t\t\t\tif (!id)\n\t\t\t\t\treturn;\n\n\t\t\t\t// const elements = document.querySelectorAll(`[${this.params.eventAdd2basket}=\"${id}\"]`);\n\n\t\t\t\t// console.log(elements);\n\n\n\t\t\t},\n\n\t\t\t// loadOnScroll: function () {\n\t\t\t// \tvar scrollTop = BX.GetWindowScrollPos().scrollTop,\n\t\t\t// \t\tcontainerBottom = BX.pos(this.container).bottom;\n\n\t\t\t// \tif (scrollTop + window.innerHeight > containerBottom) {\n\t\t\t// \t\tthis.showMore();\n\t\t\t// \t}\n\t\t\t// },\n\n\t\t\tshowMore: function () {\n\t\t\t\t// console.log(this.navParams);\n\n\t\t\t\tif (this.navParams.NavPageNomer < this.navParams.NavPageCount) {\n\t\t\t\t\tvar data = {};\n\t\t\t\t\tdata['action'] = 'showMore';\n\t\t\t\t\tdata['PAGEN_' + this.navParams.NavNum] = this.navParams.NavPageNomer + 1;\n\n\t\t\t\t\tif (!this.formPosting) {\n\t\t\t\t\t\tthis.formPosting = true;\n\t\t\t\t\t\tthis.disableButton();\n\n\t\t\t\t\t\tthis.sendRequest(data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// bigDataLoad: function () {\n\t\t\t// \tvar url = 'https://analytics.bitrix.info/crecoms/v1_0/recoms.php',\n\t\t\t// \t\tdata = BX.ajax.prepareData(this.bigData.params);\n\n\t\t\t// \tif (data) {\n\t\t\t// \t\turl += (url.indexOf('?') !== -1 ? '&' : '?') + data;\n\t\t\t// \t}\n\n\t\t\t// \tvar onReady = BX.delegate(function (result) {\n\t\t\t// \t\tthis.sendRequest({\n\t\t\t// \t\t\taction: 'deferredLoad',\n\t\t\t// \t\t\tbigData: 'Y',\n\t\t\t// \t\t\titems: result && result.items || [],\n\t\t\t// \t\t\trid: result && result.id,\n\t\t\t// \t\t\tcount: this.bigData.count,\n\t\t\t// \t\t\trowsRange: this.bigData.rowsRange,\n\t\t\t// \t\t\tshownIds: this.bigData.shownIds\n\t\t\t// \t\t});\n\t\t\t// \t}, this);\n\n\t\t\t// \tBX.ajax({\n\t\t\t// \t\tmethod: 'GET',\n\t\t\t// \t\tdataType: 'json',\n\t\t\t// \t\turl: url,\n\t\t\t// \t\ttimeout: 3,\n\t\t\t// \t\tonsuccess: onReady,\n\t\t\t// \t\tonfailure: onReady\n\t\t\t// \t});\n\t\t\t// },\n\n\t\t\t// deferredLoad: function () {\n\t\t\t// \tthis.sendRequest({ action: 'deferredLoad' });\n\t\t\t// },\n\n\t\t\tsendRequest: function (data) {\n\t\t\t\tvar defaultData = {\n\t\t\t\t\tsiteId: this.siteId,\n\t\t\t\t\ttemplate: this.template,\n\t\t\t\t\tparameters: this.parameters\n\t\t\t\t};\n\n\t\t\t\tif (this.ajaxId) {\n\t\t\t\t\tdefaultData.AJAX_ID = this.ajaxId;\n\t\t\t\t}\n\n\t\t\t\tBX.ajax({\n\t\t\t\t\turl: this.componentPath + '/ajax.php' + (document.location.href.indexOf('clear_cache=Y') !== -1 ? '?clear_cache=Y' : ''),\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\ttimeout: 60,\n\t\t\t\t\tdata: BX.merge(defaultData, data),\n\t\t\t\t\tonsuccess: BX.delegate(function (result) {\n\t\t\t\t\t\tif (!result || !result.JS)\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tBX.ajax.processScripts(\n\t\t\t\t\t\t\tBX.processHTML(result.JS).SCRIPT,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tBX.delegate(function () { this.showAction(result, data); }, this)\n\t\t\t\t\t\t);\n\t\t\t\t\t}, this)\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tshowAction: function (result, data) {\n\t\t\t\tif (!data)\n\t\t\t\t\treturn;\n\n\t\t\t\tswitch (data.action) {\n\t\t\t\t\tcase 'showMore':\n\t\t\t\t\t\tthis.processShowMoreAction(result);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'deferredLoad':\n\t\t\t\t\t\t// this.processDeferredLoadAction(result, data.bigData === 'Y');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tprocessShowMoreAction: function (result) {\n\t\t\t\tthis.formPosting = false;\n\t\t\t\tthis.enableButton();\n\n\t\t\t\tif (result) {\n\t\t\t\t\tthis.navParams.NavPageNomer++;\n\t\t\t\t\tthis.processItems(result.items);\n\t\t\t\t\tthis.processPagination(result.pagination);\n\t\t\t\t\tthis.processEpilogue(result.epilogue);\n\t\t\t\t\tthis.checkButton();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// processDeferredLoadAction: function (result, bigData) {\n\t\t\t// \tif (!result)\n\t\t\t// \t\treturn;\n\n\t\t\t// \tvar position = bigData ? this.bigData.rows : {};\n\n\t\t\t// \tthis.processItems(result.items, BX.util.array_keys(position));\n\t\t\t// },\n\n\t\t\tprocessItems: function (itemsHtml, position) {\n\t\t\t\tif (!itemsHtml)\n\t\t\t\t\treturn;\n\n\t\t\t\tlet\n\t\t\t\t\titems, k, origRows,\n\t\t\t\t\tprocessed = BX.processHTML(itemsHtml, false),\n\t\t\t\t\ttemporaryNode = BX.create('DIV');\n\n\t\t\t\ttemporaryNode.innerHTML = processed.HTML;\n\t\t\t\titems = temporaryNode.querySelectorAll('[data-entity=\"items-item\"]');\n\n\t\t\t\tif (items.length) {\n\t\t\t\t\tfor (k in items) {\n\t\t\t\t\t\tif (items.hasOwnProperty(k)) {\n\t\t\t\t\t\t\torigRows = position ? this.container?.querySelector('[data-entity=\"items-row\"]') : false;\n\n\t\t\t\t\t\t\tif (origRows && BX.type.isDomNode(origRows[position[k]]))\n\t\t\t\t\t\t\t\torigRows[position[k]].parentNode.insertBefore(items[k], origRows[position[k]]);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tthis.container?.querySelector('[data-entity=\"items-row\"]').appendChild(items[k]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tBX.ajax.processScripts(processed.SCRIPT);\n\t\t\t},\n\n\t\t\tprocessPagination: function (paginationHtml) {\n\t\t\t\tif (!paginationHtml)\n\t\t\t\t\treturn;\n\n\t\t\t\tlet pagination = document.querySelectorAll('[data-pagination-num=\"' + this.navParams.NavNum + '\"]');\n\t\t\t\tfor (var k in pagination) {\n\t\t\t\t\tif (pagination.hasOwnProperty(k)) {\n\t\t\t\t\t\tpagination[k].innerHTML = paginationHtml;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.updateUrlPaginationParam('PAGEN_' + this.navParams.NavNum, this.navParams.NavPageNomer, true)\n\t\t\t},\n\n\t\t\tupdateUrlPaginationParam: function (paginationParam, value, push = true) {\n\t\t\t\tlet url = new URL(window.location.href);\n\t\t\t\tlet params = url.searchParams;\n\n\t\t\t\tif (value === null || typeof value === 'undefined' || value === '')\n\t\t\t\t\tparams.delete(paginationParam);\n\t\t\t\telse\n\t\t\t\t\tparams.set(paginationParam, String(value));\n\n\t\t\t\tlet newUrl = url.pathname + (params.toString() ? '?' + params.toString() : '') + (url.hash || '');\n\n\t\t\t\tif (push)\n\t\t\t\t\thistory.pushState(null, '', newUrl);\n\t\t\t\telse\n\t\t\t\t\thistory.replaceState(null, '', newUrl);\n\t\t\t},\n\n\t\t\tprocessEpilogue: function (epilogueHtml) {\n\t\t\t\tif (!epilogueHtml)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar processed = BX.processHTML(epilogueHtml, false);\n\t\t\t\tBX.ajax.processScripts(processed.SCRIPT);\n\t\t\t},\n\n\t\t\t// showHeader: function (animate) {\n\t\t\t// \tvar parentNode = BX.findParent(this.container, { attr: { 'data-entity': 'parent-container' } }),\n\t\t\t// \t\theader;\n\n\t\t\t// \tif (parentNode && BX.type.isDomNode(parentNode)) {\n\t\t\t// \t\theader = parentNode.querySelector('[data-entity=\"header\"]');\n\n\t\t\t// \t\tif (header && header.getAttribute('data-showed') != 'true') {\n\t\t\t// \t\t\theader.style.display = '';\n\n\t\t\t// \t\t\tif (animate) {\n\t\t\t// \t\t\t\tnew BX.easing({\n\t\t\t// \t\t\t\t\tduration: 2000,\n\t\t\t// \t\t\t\t\tstart: { opacity: 0 },\n\t\t\t// \t\t\t\t\tfinish: { opacity: 100 },\n\t\t\t// \t\t\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quad),\n\t\t\t// \t\t\t\t\tstep: function (state) {\n\t\t\t// \t\t\t\t\t\theader.style.opacity = state.opacity / 100;\n\t\t\t// \t\t\t\t\t},\n\t\t\t// \t\t\t\t\tcomplete: function () {\n\t\t\t// \t\t\t\t\t\theader.removeAttribute('style');\n\t\t\t// \t\t\t\t\t\theader.setAttribute('data-showed', 'true');\n\t\t\t// \t\t\t\t\t}\n\t\t\t// \t\t\t\t}).animate();\n\t\t\t// \t\t\t}\n\t\t\t// \t\t\telse {\n\t\t\t// \t\t\t\theader.style.opacity = 100;\n\t\t\t// \t\t\t}\n\t\t\t// \t\t}\n\t\t\t// \t}\n\t\t\t// }\n\t\t};\n\t}\n\n\tif (!window.basketItems) {\n\t\twindow.BasketItems = function (ids) {\n\t\t\tthis.ids = ids || {};\n\t\t};\n\n\t\twindow.BasketItems.prototype = {\n\t\t\tprocessIds: function () {\n\t\t\t\tif (this.ids && Object.keys(this.ids).length > 0) {\n\t\t\t\t\tObject.keys(this.ids).forEach(function (id) {\n\n\t\t\t\t\t\tconst elements = document.querySelectorAll(\"[data-add2basket='\" + id + \"']\");\n\n\t\t\t\t\t\telements.forEach(function (el) {\n\t\t\t\t\t\t\tel.classList.remove('btn-outline-primary');\n\t\t\t\t\t\t\tel.classList.add('btn-success');\n\t\t\t\t\t\t\tel.textContent = 'В корзине';\n\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// addIds: function (newIds) {\n\t\t\t// \tif (Array.isArray(newIds)) {\n\t\t\t// \t\tthis.ids = this.ids.concat(newIds);\n\t\t\t// \t\tthis.processIds();\n\t\t\t// \t}\n\t\t\t// }\n\t\t};\n\n\n\t\t// Создаем экземпляр с нашими ID\n\n\t\t// Запускаем обработку после загрузки DOM\n\n\t}\n\n\n})();"],"file":"script.js"}