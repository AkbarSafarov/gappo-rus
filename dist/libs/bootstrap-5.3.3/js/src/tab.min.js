import BaseComponent from"./base-component.js";import EventHandler from"./dom/event-handler.js";import SelectorEngine from"./dom/selector-engine.js";import{defineJQueryPlugin,getNextActiveElement,isDisabled}from"./util/index.js";const NAME="tab",DATA_KEY="bs.tab",EVENT_KEY=".bs.tab",EVENT_HIDE="hide.bs.tab",EVENT_HIDDEN="hidden.bs.tab",EVENT_SHOW="show.bs.tab",EVENT_SHOWN="shown.bs.tab",EVENT_CLICK_DATA_API="click.bs.tab",EVENT_KEYDOWN="keydown.bs.tab",EVENT_LOAD_DATA_API="load.bs.tab",ARROW_LEFT_KEY="ArrowLeft",ARROW_RIGHT_KEY="ArrowRight",ARROW_UP_KEY="ArrowUp",ARROW_DOWN_KEY="ArrowDown",HOME_KEY="Home",END_KEY="End",CLASS_NAME_ACTIVE="active",CLASS_NAME_FADE="fade",CLASS_NAME_SHOW="show",CLASS_DROPDOWN="dropdown",SELECTOR_DROPDOWN_TOGGLE=".dropdown-toggle",SELECTOR_DROPDOWN_MENU=".dropdown-menu",NOT_SELECTOR_DROPDOWN_TOGGLE=`:not(${SELECTOR_DROPDOWN_TOGGLE})`,SELECTOR_TAB_PANEL='.list-group, .nav, [role="tablist"]',SELECTOR_OUTER=".nav-item, .list-group-item",SELECTOR_INNER=`.nav-link${NOT_SELECTOR_DROPDOWN_TOGGLE}, .list-group-item${NOT_SELECTOR_DROPDOWN_TOGGLE}, [role="tab"]${NOT_SELECTOR_DROPDOWN_TOGGLE}`,SELECTOR_DATA_TOGGLE='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',SELECTOR_INNER_ELEM=`${SELECTOR_INNER}, ${SELECTOR_DATA_TOGGLE}`,SELECTOR_DATA_TOGGLE_ACTIVE=`.${CLASS_NAME_ACTIVE}[data-bs-toggle="tab"], .${CLASS_NAME_ACTIVE}[data-bs-toggle="pill"], .${CLASS_NAME_ACTIVE}[data-bs-toggle="list"]`;class Tab extends BaseComponent{constructor(t){super(t),this._parent=this._element.closest(SELECTOR_TAB_PANEL),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),EventHandler.on(this._element,EVENT_KEYDOWN,t=>this._keydown(t)))}static get NAME(){return NAME}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),E=e?EventHandler.trigger(e,EVENT_HIDE,{relatedTarget:t}):null;EventHandler.trigger(t,EVENT_SHOW,{relatedTarget:e}).defaultPrevented||E&&E.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){if(!t)return;t.classList.add(CLASS_NAME_ACTIVE),this._activate(SelectorEngine.getElementFromSelector(t));this._queueCallback(()=>{"tab"===t.getAttribute("role")?(t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),EventHandler.trigger(t,EVENT_SHOWN,{relatedTarget:e})):t.classList.add(CLASS_NAME_SHOW)},t,t.classList.contains(CLASS_NAME_FADE))}_deactivate(t,e){if(!t)return;t.classList.remove(CLASS_NAME_ACTIVE),t.blur(),this._deactivate(SelectorEngine.getElementFromSelector(t));this._queueCallback(()=>{"tab"===t.getAttribute("role")?(t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),EventHandler.trigger(t,EVENT_HIDDEN,{relatedTarget:e})):t.classList.remove(CLASS_NAME_SHOW)},t,t.classList.contains(CLASS_NAME_FADE))}_keydown(t){if(![ARROW_LEFT_KEY,ARROW_RIGHT_KEY,ARROW_UP_KEY,ARROW_DOWN_KEY,HOME_KEY,END_KEY].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=this._getChildren().filter(t=>!isDisabled(t));let E;if([HOME_KEY,END_KEY].includes(t.key))E=e[t.key===HOME_KEY?0:e.length-1];else{const s=[ARROW_RIGHT_KEY,ARROW_DOWN_KEY].includes(t.key);E=getNextActiveElement(e,t.target,s,!0)}E&&(E.focus({preventScroll:!0}),Tab.getOrCreateInstance(E).show())}_getChildren(){return SelectorEngine.find(SELECTOR_INNER_ELEM,this._parent)}_getActiveElem(){return this._getChildren().find(t=>this._elemIsActive(t))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const t of e)this._setInitialAttributesOnChild(t)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),E=this._getOuterElement(t);t.setAttribute("aria-selected",e),E!==t&&this._setAttributeIfNotExists(E,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=SelectorEngine.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const E=this._getOuterElement(t);if(!E.classList.contains(CLASS_DROPDOWN))return;const s=(t,s)=>{const i=SelectorEngine.findOne(t,E);i&&i.classList.toggle(s,e)};s(SELECTOR_DROPDOWN_TOGGLE,CLASS_NAME_ACTIVE),s(SELECTOR_DROPDOWN_MENU,CLASS_NAME_SHOW),E.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,E){t.hasAttribute(e)||t.setAttribute(e,E)}_elemIsActive(t){return t.classList.contains(CLASS_NAME_ACTIVE)}_getInnerElement(t){return t.matches(SELECTOR_INNER_ELEM)?t:SelectorEngine.findOne(SELECTOR_INNER_ELEM,t)}_getOuterElement(t){return t.closest(SELECTOR_OUTER)||t}static jQueryInterface(t){return this.each(function(){const e=Tab.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}})}}EventHandler.on(document,"click.bs.tab",SELECTOR_DATA_TOGGLE,function(t){["A","AREA"].includes(this.tagName)&&t.preventDefault(),isDisabled(this)||Tab.getOrCreateInstance(this).show()}),EventHandler.on(window,"load.bs.tab",()=>{for(const t of SelectorEngine.find(SELECTOR_DATA_TOGGLE_ACTIVE))Tab.getOrCreateInstance(t)}),defineJQueryPlugin(Tab);export default Tab;