"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}window.JCCatalogSectionComponent||(window.JCCatalogSectionComponent=function(t){var e,o,a;this.formPosting=!1,this.siteId=t.siteId||"",this.ajaxId=t.ajaxId||"",this.template=t.template||"",this.componentPath=t.componentPath||"",this.parameters=t.parameters||"",this.containerSelector=t.container||"",this.container=null,this.ajaxPath="/local/ajax/",this.sessid=null!==(e=null===(o=BX)||void 0===o?void 0:o.bitrix_sessid())&&void 0!==e?e:null,this.lazyLoad=null!==(a=t.lazyLoad)&&void 0!==a&&a,this.showMoreButton=null,this.showMoreButtonMessage=null,this.params={eventAdd2Basket:"data-add2basket"},t.navParams&&(this.navParams={NavNum:t.navParams.NavNum||1,NavPageNomer:parseInt(t.navParams.NavPageNomer)||1,NavPageCount:parseInt(t.navParams.NavPageCount)||1}),"object"===_typeof(t)&&document.addEventListener("DOMContentLoaded",this.init.bind(this))},window.JCCatalogSectionComponent.prototype={init:function(){var t=this;this.containerSelector&&(this.container=document.querySelector('[data-entity="'+this.containerSelector+'"]'),this.container.querySelectorAll("["+this.params.eventAdd2Basket+"]").forEach(function(e){e.addEventListener("click",t.add2basket.bind(t))})),this.lazyLoad&&(this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]'),this.showMoreButtonMessage=this.showMoreButton.innerHTML,this.showMoreButton.addEventListener("click",this.showMore.bind(this)))},add2basket:function(t){var e=t.currentTarget,o=e.getAttribute(this.params.eventAdd2Basket);e.innerHTML,e.disabled=!0;var a={sessid:this.sessid,action:"add2basket",productId:o};fetch(this.ajaxPath+"add2basket.php",{method:"POST",body:JSON.stringify(a),headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}}).then(function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(function(t){var e,o,a,n;"object"===_typeof(null===(e=BX)||void 0===e||null===(e=e.UI)||void 0===e?void 0:e.Notification)&&(o=null!==(n=null==t?void 0:t.text)&&void 0!==n?n:null,a="success"!==t.type?{type:"danger",icon:"warning"}:{type:"success"},o&&BX.UI.Notification.Center.notify({content:o,data:a,position:"top-right",render:alertBalloonRenderer,category:"add2basket",autoHide:!0,autoHideDelay:3e3}))}).catch(function(t){return console.error("Fetch error:",t)}).finally(function(){e.disabled=!1,BX.onCustomEvent("OnBasketChange")})},checkButton:function(){this.showMoreButton&&this.navParams.NavPageNomer==this.navParams.NavPageCount&&this.showMoreButton.remove()},enableButton:function(){this.showMoreButton&&(this.showMoreButton.classList.remove("disabled"),this.showMoreButton.innerHTML=this.showMoreButtonMessage)},disableButton:function(){this.showMoreButton&&this.showMoreButton.classList.add("disabled")},setAddBasketItems:function(t){"object"===_typeof(t)&&Object.keys(t).forEach(function(t){})},setAddBasketItem:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var t={action:"showMore"};t["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.disableButton(),this.sendRequest(t))}},sendRequest:function(t){var e={siteId:this.siteId,template:this.template,parameters:this.parameters};this.ajaxId&&(e.AJAX_ID=this.ajaxId),BX.ajax({url:this.componentPath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(e,t),onsuccess:BX.delegate(function(e){e&&e.JS&&BX.ajax.processScripts(BX.processHTML(e.JS).SCRIPT,!1,BX.delegate(function(){this.showAction(e,t)},this))},this)})},showAction:function(t,e){if(e)switch(e.action){case"showMore":this.processShowMoreAction(t)}},processShowMoreAction:function(t){this.formPosting=!1,this.enableButton(),t&&(this.navParams.NavPageNomer++,this.processItems(t.items),this.processPagination(t.pagination),this.processEpilogue(t.epilogue),this.checkButton())},processItems:function(t,e){if(t){var o,a,n,s=BX.processHTML(t,!1),i=BX.create("DIV");if(i.innerHTML=s.HTML,(o=i.querySelectorAll('[data-entity="items-item"]')).length)for(a in o){var r,c;o.hasOwnProperty(a)&&((n=!!e&&(null===(r=this.container)||void 0===r?void 0:r.querySelector('[data-entity="items-row"]')))&&BX.type.isDomNode(n[e[a]])?n[e[a]].parentNode.insertBefore(o[a],n[e[a]]):null===(c=this.container)||void 0===c||c.querySelector('[data-entity="items-row"]').appendChild(o[a]))}BX.ajax.processScripts(s.SCRIPT)}},processPagination:function(t){if(t){var e=document.querySelectorAll('[data-pagination-num="'+this.navParams.NavNum+'"]');for(var o in e)e.hasOwnProperty(o)&&(e[o].innerHTML=t);this.updateUrlPaginationParam("PAGEN_"+this.navParams.NavNum,this.navParams.NavPageNomer,!0)}},updateUrlPaginationParam:function(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=new URL(window.location.href),n=a.searchParams;null==e||""===e?n.delete(t):n.set(t,String(e));var s=a.pathname+(n.toString()?"?"+n.toString():"")+(a.hash||"");o?history.pushState(null,"",s):history.replaceState(null,"",s)},processEpilogue:function(t){if(t){var e=BX.processHTML(t,!1);BX.ajax.processScripts(e.SCRIPT)}}}),window.basketItems||(window.BasketItems=function(t){this.ids=t||{}},window.BasketItems.prototype={processIds:function(){this.ids&&Object.keys(this.ids).length>0&&Object.keys(this.ids).forEach(function(t){document.querySelectorAll("[data-add2basket='"+t+"']").forEach(function(t){t.classList.remove("btn-outline-primary"),t.classList.add("btn-success"),t.textContent="В корзине"})})}});